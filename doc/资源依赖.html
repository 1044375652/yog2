<h4 class=""><a name="%E5%9C%A8%20html%20%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96" href="#%E5%9C%A8%20html%20%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96">在 html 中声明依赖</a></h4><blockquote>
<p>用户可以在 html 的注释中声明依赖关系，这些依赖关系最终会被记录到 fis 编译产出的 <strong>map.json</strong> 文件中。</p>
</blockquote>
<p>在项目的 index.html 里使用注释声明依赖关系：</p>
<pre><code class="hljs lang-html"><span class="hljs-comment">&lt;!--
    @require demo.js
    @require "demo.css"
--&gt;</span>
</code></pre>
<p>默认情况下，只有 js 和 css 文件会输出到 map.json 表中，如果想将 html 文件加入表中，需要通过配置 <code>useMap</code> 让 HTML 文件加入 map.json，例如：</p>
<pre><code class="hljs lang-javascript"><span class="hljs-comment">//fis-conf.js</span>
fis.config.merge({
    <span class="hljs-string">roadmap :</span> {
        <span class="hljs-string">path :</span> [
            {
                <span class="hljs-comment">//所有的html文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-string">'**.html'</span>,
                <span class="hljs-comment">//输出到map.json表中</span>
                <span class="hljs-string">useMap :</span> <span class="hljs-literal">true</span>
            }
        ]
    }
});
</code></pre>
<p>执行 fis release --dest ./output --md5 命令对项目进行编译，查看 output 目录下的 map.json 文件，则可看到：</p>
<pre><code class="hljs lang-json">{
    "<span class="hljs-attribute">res</span>" : <span class="hljs-value">{
        "<span class="hljs-attribute">demo.css</span>" : <span class="hljs-value">{
            "<span class="hljs-attribute">uri</span>" : <span class="hljs-value"><span class="hljs-string">"/static/css/demo_7defa41.css"</span></span>,
            "<span class="hljs-attribute">type</span>" : <span class="hljs-value"><span class="hljs-string">"css"</span>
        </span>}</span>,
        "<span class="hljs-attribute">demo.js</span>" : <span class="hljs-value">{
            "<span class="hljs-attribute">uri</span>" : <span class="hljs-value"><span class="hljs-string">"/static/js/demo_33c5143.js"</span></span>,
            "<span class="hljs-attribute">type</span>" : <span class="hljs-value"><span class="hljs-string">"js"</span></span>,
            "<span class="hljs-attribute">deps</span>" : <span class="hljs-value">[ <span class="hljs-string">"demo.css"</span> ]
        </span>}</span>,
        "<span class="hljs-attribute">index.html</span>" : <span class="hljs-value">{
            "<span class="hljs-attribute">uri</span>" : <span class="hljs-value"><span class="hljs-string">"/index.html"</span></span>,
            "<span class="hljs-attribute">type</span>" : <span class="hljs-value"><span class="hljs-string">"html"</span></span>,
            "<span class="hljs-attribute">deps</span>" : <span class="hljs-value">[ <span class="hljs-string">"demo.js"</span>, <span class="hljs-string">"demo.css"</span> ]
        </span>}
    </span>}</span>,
    "<span class="hljs-attribute">pkg</span>" : <span class="hljs-value">{}
</span>}
</code></pre>
<h4 class=""><a name="%E5%9C%A8%20js%20%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96" href="#%E5%9C%A8%20js%20%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96">在 js 中声明依赖</a></h4><blockquote>
<p>fis 支持识别 js 文件中的 <strong>require 函数 </strong>，或者 <strong> 注释中的 @require 字段</strong> 标记的依赖关系，这些分析处理对 <strong>html 的 script 标签内容</strong> 同样有效。</p>
</blockquote>
<pre><code class="hljs lang-javascript">//demo.js
/<span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
 <span class="hljs-keyword">*</span> <span class="hljs-comment">@require demo.css</span>
 <span class="hljs-keyword">*</span> <span class="hljs-comment">@require list.js</span>
 <span class="hljs-keyword">*</span>/
var $ = require('jquery');
</code></pre>
<p>经过编译之后，查看产出的 <strong>map.json</strong> 文件，可以看到：</p>
<pre><code class="hljs lang-json">{
    <span class="hljs-string">"res"</span> : {
        <span class="hljs-keyword">...</span>
        <span class="hljs-string">"demo.js"</span> : {
            <span class="hljs-string">"uri"</span> : <span class="hljs-string">"/static/js/demo_33c5143.js"</span>,
            <span class="hljs-string">"type"</span> : <span class="hljs-string">"js"</span>,
            <span class="hljs-string">"deps"</span> : [ <span class="hljs-string">"demo.css"</span>, <span class="hljs-string">"list.js"</span>, <span class="hljs-string">"jquery"</span> ]
        },
        <span class="hljs-keyword">...</span>
    },
    <span class="hljs-string">"pkg"</span> : {}
}
</code></pre>
<h4 class=""><a name="%E5%9C%A8%20css%20%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96" href="#%E5%9C%A8%20css%20%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96">在 css 中声明依赖</a></h4><blockquote>
<p>fis 支持识别 css 文件 <strong> 注释中的 @require 字段 </strong> 标记的依赖关系，这些分析处理对 <strong>html 的 style 标签内容 </strong> 同样有效。</p>
</blockquote>
<pre><code class="hljs lang-css">/<span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
 <span class="hljs-keyword">*</span> demo.css
 <span class="hljs-keyword">*</span> <span class="hljs-comment">@require reset.css</span>
 <span class="hljs-keyword">*</span>/
</code></pre>
<p>经过编译之后，查看产出的 <strong>map.json</strong> 文件，可以看到：</p>
<pre><code class="hljs lang-json">{
    <span class="hljs-string">"res"</span> : {
        <span class="hljs-keyword">...</span>
        <span class="hljs-string">"demo.css"</span> : {
            <span class="hljs-string">"uri"</span> : <span class="hljs-string">"/static/css/demo_7defa41.css"</span>,
            <span class="hljs-string">"type"</span> : <span class="hljs-string">"css"</span>,
            <span class="hljs-string">"deps"</span> : [ <span class="hljs-string">"reset.css"</span> ]
        },
        <span class="hljs-keyword">...</span>
    },
    <span class="hljs-string">"pkg"</span> : {}
}
</code></pre>
