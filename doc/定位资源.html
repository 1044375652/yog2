<h4 class=""><a name="%E5%9C%A8%20html%20%E4%B8%AD%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90" href="#%E5%9C%A8%20html%20%E4%B8%AD%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90">在 html 中定位资源</a></h4><blockquote>
<p>fis 支持对 html 中的 script、link、style、video、audio、embed 等标签的 src 或 href 属性进行分析，一旦这些标签的资源定位属性可以命中已存在文件，则把命中文件的 url 路径替换到属性中，同时可保留原来 url 中的 query 查询信息。</p>
</blockquote>
<p>例如：</p>
<pre><code class="hljs lang-html"><span class="hljs-comment">&lt;!--源码：
&lt;img title="百度logo" src="images/logo.gif"/&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"百度logo"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/images/logo_74e5229.gif"</span>/&gt;</span>

<span class="hljs-comment">&lt;!--源码：
&lt;link rel="stylesheet" type="text/css" href="demo.css"&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/demo_7defa41.css"</span>&gt;</span>

<span class="hljs-comment">&lt;!--源码：
&lt;script type="text/javascript" src="demo.js"&gt;&lt;/script&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/demo_33c5143.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>值得注意的是， <strong> 资源定位结果可以被 fis 的配置文件控制 </strong>，比如添加配置，调整文件发布路径：</p>
<p><img src="https://raw.githubusercontent.com/fouber/fis-wiki-img/master/uri.png" alt="资源定位工作原理"></p>
<pre><code class="hljs lang-javascript">fis.config.merge({
    <span class="hljs-string">roadmap :</span> {
        <span class="hljs-string">path :</span> [
            {
                <span class="hljs-comment">//所有的js文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-string">'**.js'</span>,
                <span class="hljs-comment">//发布到/static/js/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/js$&amp;'</span>
            },
            {
                <span class="hljs-comment">//所有的css文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-string">'**.css'</span>,
                <span class="hljs-comment">//发布到/static/css/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/css$&amp;'</span>
            },
            {
                <span class="hljs-comment">//所有image目录下的.png，.gif文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-regexp">/^\/</span>images\<span class="hljs-regexp">/(.*\.(?:png|gif))/</span>i,
                <span class="hljs-comment">//发布到/static/pic/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/pic/$1'</span>
            }
        ]
    }
});
</code></pre>
<p>再次编译得到：</p>
<pre><code class="hljs lang-html"><span class="hljs-comment">&lt;!--源码：
&lt;img title="百度logo" src="images/logo.gif"/&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"百度logo"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/static/pic/logo_74e5229.gif"</span>/&gt;</span>

<span class="hljs-comment">&lt;!--源码：
&lt;link rel="stylesheet" type="text/css" href="demo.css"&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/static/css/demo_7defa41.css"</span>&gt;</span>

<span class="hljs-comment">&lt;!--源码：
&lt;script type="text/javascript" src="demo.js"&gt;&lt;/script&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/static/js/demo_33c5143.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>我们甚至可以让 <strong>url 和发布目录不一致 </strong>。比如：</p>
<pre><code class="hljs lang-javascript"><span class="xml">fis.config.merge(</span><span class="hljs-expression">{
    <span class="hljs-variable">roadmap</span> : {
        <span class="hljs-variable">path</span> : [
            {
                //所有的<span class="hljs-variable">js</span>文件
                <span class="hljs-variable">reg</span> : '**<span class="hljs-variable">.js</span>',
                //发布到<span class="hljs-end-block">/static</span><span class="hljs-end-block">/js</span><span class="hljs-end-block">/xxx</span>目录下
                <span class="hljs-variable">release</span> : '<span class="hljs-end-block">/static</span><span class="hljs-end-block">/js</span>$&amp;',
                //访问<span class="hljs-variable">url</span>是<span class="hljs-end-block">/mm</span><span class="hljs-end-block">/static</span><span class="hljs-end-block">/js</span><span class="hljs-end-block">/xxx</span>
                <span class="hljs-variable">url</span> : '<span class="hljs-end-block">/mm</span><span class="hljs-end-block">/static</span><span class="hljs-end-block">/js</span>$&amp;'
            }</span><span class="xml">,
            </span><span class="hljs-expression">{
                //所有的<span class="hljs-variable">css</span>文件
                <span class="hljs-variable">reg</span> : '**<span class="hljs-variable">.css</span>',
                //发布到<span class="hljs-end-block">/static</span><span class="hljs-end-block">/css</span><span class="hljs-end-block">/xxx</span>目录下
                <span class="hljs-variable">release</span> : '<span class="hljs-end-block">/static</span><span class="hljs-end-block">/css</span>$&amp;',
                //访问<span class="hljs-variable">url</span>是<span class="hljs-end-block">/pp</span><span class="hljs-end-block">/static</span><span class="hljs-end-block">/css</span><span class="hljs-end-block">/xxx</span>
                <span class="hljs-variable">url</span> : '<span class="hljs-end-block">/pp</span><span class="hljs-end-block">/static</span><span class="hljs-end-block">/css</span>$&amp;'
            }</span><span class="xml">,
            </span><span class="hljs-expression">{
                //所有<span class="hljs-variable">image</span>目录下的<span class="hljs-variable">.png</span>，<span class="hljs-variable">.gif</span>文件
                <span class="hljs-variable">reg</span> : /^\<span class="hljs-end-block">/images</span>\/(<span class="hljs-variable">.</span>*\<span class="hljs-variable">.</span>(?:<span class="hljs-variable">png</span>|<span class="hljs-variable">gif</span>))<span class="hljs-end-block">/i</span>,
                //发布到<span class="hljs-end-block">/static</span><span class="hljs-end-block">/pic</span><span class="hljs-end-block">/xxx</span>目录下
                <span class="hljs-variable">release</span> : '<span class="hljs-end-block">/static</span><span class="hljs-end-block">/pic</span>/$1',
                //访问<span class="hljs-variable">url</span>是<span class="hljs-end-block">/oo</span><span class="hljs-end-block">/static</span><span class="hljs-end-block">/baidu</span><span class="hljs-end-block">/xxx</span>
                <span class="hljs-variable">url</span> : '<span class="hljs-end-block">/oo</span><span class="hljs-end-block">/static</span><span class="hljs-end-block">/baidu</span>$&amp;'
            }</span><span class="xml">
        ]
    }
});</span>
</code></pre>
<p>再次编译得到：</p>
<pre><code class="hljs lang-html"><span class="hljs-comment">&lt;!--源码：
&lt;img title="百度logo" src="images/logo.gif"/&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"百度logo"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/oo/static/baidu/logo_74e5229.gif"</span>/&gt;</span>

<span class="hljs-comment">&lt;!--源码：
&lt;link rel="stylesheet" type="text/css" href="demo.css"&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/pp/static/css/demo_7defa41.css"</span>&gt;</span>

<span class="hljs-comment">&lt;!--源码：
&lt;script type="text/javascript" src="demo.js"&gt;&lt;/script&gt;
编译后--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/mm/static/js/demo_33c5143.js"</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<h4 class=""><a name="%E5%9C%A8%20js%20%E4%B8%AD%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90" href="#%E5%9C%A8%20js%20%E4%B8%AD%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90">在 js 中定位资源</a></h4><blockquote>
<p>js 语言中，可以使用编译函数 <strong>__uri(path)</strong> 来定位资源，fis 分析 js 文件或 <strong>html 中的 script 标签内内容 </strong> 时会替换该函数所指向文件的线上 url 路径。</p>
</blockquote>
<ul>
<li><p>源码:</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> img = __uri(<span class="hljs-string">'images/logo.gif'</span>);
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> img = <span class="hljs-string">'/images/logo_74e5229.gif'</span>;
</code></pre>
</li>
<li><p>源码:</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> css = __uri(<span class="hljs-string">'demo.css'</span>);
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> css = <span class="hljs-string">'/demo_7defa41.css'</span>;
</code></pre>
</li>
<li><p>源码:</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> js = __uri(<span class="hljs-string">'demo.js'</span>);
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> js = <span class="hljs-string">'/demo_33c5143.js'</span>;
</code></pre>
</li>
</ul>
<p><strong> 资源定位结果可以被 fis 的配置文件控制 </strong>，比如添加配置，调整文件发布路径：</p>
<pre><code class="hljs lang-javascript">fis.config.merge({
    <span class="hljs-string">roadmap :</span> {
        <span class="hljs-string">path :</span> [
            {
                <span class="hljs-comment">//所有的js文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-string">'**.js'</span>,
                <span class="hljs-comment">//发布到/static/js/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/js$&amp;'</span>
            },
            {
                <span class="hljs-comment">//所有的css文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-string">'**.css'</span>,
                <span class="hljs-comment">//发布到/static/css/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/css$&amp;'</span>
            },
            {
                <span class="hljs-comment">//所有image目录下的.png，.gif文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-regexp">/^\/</span>images\<span class="hljs-regexp">/(.*\.(?:png|gif))/</span>i,
                <span class="hljs-comment">//发布到/static/pic/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/pic/$1'</span>
            }
        ]
    }
});
</code></pre>
<p>再次编译得到：</p>
<ul>
<li><p>源码:</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> img = __uri(<span class="hljs-string">'images/logo.gif'</span>);
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> img = <span class="hljs-string">'/static/pic/logo_74e5229.gif'</span>;
</code></pre>
</li>
<li><p>源码:</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> css = __uri(<span class="hljs-string">'demo.css'</span>);
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> css = <span class="hljs-string">'/static/css/demo_7defa41.css'</span>;
</code></pre>
</li>
<li><p>源码:</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> js = __uri(<span class="hljs-string">'demo.js'</span>);
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-javascript">  <span class="hljs-keyword">var</span> js = <span class="hljs-string">'/static/js/demo_33c5143.js'</span>;
</code></pre>
</li>
</ul>
<h4 class=""><a name="%E5%9C%A8%20css%20%E4%B8%AD%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90" href="#%E5%9C%A8%20css%20%E4%B8%AD%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90">在 css 中定位资源</a></h4><blockquote>
<p>fis 编译工具会识别 css 文件或 <strong>html 的 style 标签内容 </strong> 中 <strong>url(path)</strong> 以及 <strong>src=path</strong> 字段，并将其替换成对应资源的编译后 url 路径</p>
</blockquote>
<ul>
<li><p>源码：</p>
<pre><code class="hljs lang-css">  <span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-function">url</span>(<span class="hljs-string">'demo.css'</span>)</span>;
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-css">  <span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-function">url</span>(<span class="hljs-string">'/demo_7defa41.css'</span>)</span>;
</code></pre>
</li>
<li><p>源码：</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-function">url</span>(<span class="hljs-string">'images/body-bg.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-function">url</span>(<span class="hljs-string">'/images/body-bg_1b8c3e0.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
<li><p>源码：</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">_filter</span>:<span class="hljs-value">progid:DXImageTransform.Microsoft.<span class="hljs-function">AlphaImageLoader</span>(src=<span class="hljs-string">'images/body-bg.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">_filter</span>:<span class="hljs-value">progid:DXImageTransform.Microsoft.<span class="hljs-function">AlphaImageLoader</span>(src=<span class="hljs-string">'/images/body-bg_1b8c3e0.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
</ul>
<p><strong> 资源定位结果可以被 fis 的配置文件控制 </strong>，比如添加配置，调整文件发布路径：</p>
<pre><code class="hljs lang-javascript">fis.config.merge({
    <span class="hljs-string">roadmap :</span> {
        <span class="hljs-string">path :</span> [
            {
                <span class="hljs-comment">//所有的css文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-string">'**.css'</span>,
                <span class="hljs-comment">//发布到/static/css/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/css$&amp;'</span>
            },
            {
                <span class="hljs-comment">//所有image目录下的.png，.gif文件</span>
                <span class="hljs-string">reg :</span> <span class="hljs-regexp">/^\/</span>images\<span class="hljs-regexp">/(.*\.(?:png|gif))/</span>i,
                <span class="hljs-comment">//发布到/static/pic/<span class="hljs-label">xxx目录下</span></span>
                <span class="hljs-string">release :</span> <span class="hljs-string">'/static/pic/$1'</span>
            }
        ]
    }
});
</code></pre>
<p>再次编译得到：</p>
<ul>
<li><p>源码：</p>
<pre><code class="hljs lang-css">  <span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-function">url</span>(<span class="hljs-string">'demo.css'</span>)</span>;
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-css">  <span class="hljs-at_rule">@<span class="hljs-keyword">import</span> <span class="hljs-function">url</span>(<span class="hljs-string">'/static/css/demo_7defa41.css'</span>)</span>;
</code></pre>
</li>
<li><p>源码：</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-function">url</span>(<span class="hljs-string">'images/body-bg.png'</span>)</span></span>;
      <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-function">url</span>(<span class="hljs-string">'/static/pic/body-bg_1b8c3e0.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> <span class="hljs-function">url</span>(<span class="hljs-string">'/static/pic/body-bg_1b8c3e0.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
<li><p>源码：</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">_filter</span>:<span class="hljs-value">progid:DXImageTransform.Microsoft.<span class="hljs-function">AlphaImageLoader</span>(src=<span class="hljs-string">'images/body-bg.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
<li><p>编译后</p>
<pre><code class="hljs lang-css">  <span class="hljs-class">.style</span> <span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">_filter</span>:<span class="hljs-value">progid:DXImageTransform.Microsoft.<span class="hljs-function">AlphaImageLoader</span>(src=<span class="hljs-string">'/static/pic/body-bg_1b8c3e0.png'</span>)</span></span>;
  <span class="hljs-rule">}</span></span>
</code></pre>
</li>
</ul>
