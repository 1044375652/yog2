<!DOCTYPE html>
<html>
    <!--head-->
    <head>
      <!-- page title goes here -->
<title>YOG2 - 工业级 Node.js UI 层解决方案</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<!-- add your name or URL here -->
<meta name="author" content="fex@baidu.com">
<!-- add a description of your site/company/product here -->
<meta name="description" content="YOG2 - 工业级 Node.js UI 层解决方案">
<!-- add the keywords here that represent your site, an example few have been added -->
<meta name="keywords" content="node, nodejs, fis, fex">
<!-- add your name or URL here -->
<meta name="publisher" content="fex">
<meta name="rating" content="General">
<!-- Bootstrap -->
<link href="/yog2/css/bootstrap.css" rel="stylesheet" media="screen">
<!-- Theme styles -->
<link href="/yog2/css/styles.css" rel="stylesheet" media="screen">
<link href="/yog2/css/animate.min.css" rel="stylesheet" media="screen">
<link href="/yog2/css/font-awesome.min.css" rel="stylesheet" media="screen">
<!-- media-queries -->
<link href="/yog2/css/media-queries.css" rel="stylesheet" media="screen">
<!-- modernizr -->
<script src="/yog2/js/modernizr.custom.js"></script>
<script src="/yog2/js/wow.min.js"></script>

      <link rel="stylesheet" href="/yog2/css/github.css">
    </head>
    <!--head-->
  <body>
    <nav class="navbar" role="navigation">
    <!-- container -->
<div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">YOG2</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse  navbar-collapse  navbar-ex1-collapse">
        <ul class="nav  navbar-nav">
            <li><a href="/yog2/">首页</a></li>
            <li><a href="/yog2/docs">文档</a></li>
            <li><a href="https://github.com/fex-team/yog2" target="_blank">Github</a></li>
            <li><a href="http://fis.baidu.com" target="_blank">FIS</a></li>
            <li><a href="http://fex.baidu.com" target="_blank">FEX</a></li>
        </ul>
    </div>
    <!-- /navbar-collapse -->
</div>
<!-- /container -->

    </nav>
    <div class="doc-wrap">
    <nav class="sidebar" data-spy="affix" data-offset-top="95">
    <ul>
        
        <li class="item-category">
            
            <a href="/yog2/docs/">
                快速入门
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                基础使用
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/cli.html#命令行">
                命令行
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/structure.html#目录结构">
                目录结构
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/router.html#路由">
                路由
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/mvc.html#mvc">
                MVC
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                插件系统
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/plugin-system/#插件系统">
                内置插件
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/plugin-system/#用户插件">
                用户插件
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/plugin-system/#插件配置">
                插件配置
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                内置功能
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/features/middleware.html#中间件管理">
                中间件管理
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/features/log.html#日志管理">
                日志管理
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/features/service.html#服务管理">
                服务管理
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                前端工程化
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/engineering.html#前端工程化">
                目录规范
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/engineering.html#三种语言能力">
                三种语言能力
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/engineering.html#前端模块化">
                前端模块化
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/backend-template.html#后端模板">
                后端模板
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/optimizer.html#性能优化">
                性能优化
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                进阶功能
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/advance/pagelet.html#BigPipe">
                BigPipe
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/advance/pagelet.html#Quickling">
                Quickling
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                其他
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/reference.html#参考资料">
                参考资料
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/FAQ.html#faq">
                FAQ
            </a>
            
        </li>
        
    </ul>
</nav>
<div class="bottom-shadow"></div>

    <div class="doc-container">
      <div class="toc" data-spy="affix" data-offset-top="95"></div>
      <article class="doc-content codehilite">
      <h2 id="后端模板">后端模板</h2>

<p>在 fis 提供的三种语言能力中，并没有提供对声明依赖的资源进行加载的功能。因此在 yog2 中，我们通过扩展 swig 后端模板引擎，来添加对资源的加载能力。</p>

<p>yog2 会重写 <code>html</code>,  <code>head</code>,  <code>body</code> 标签用于搭建资源加载的总体框架，并且添加了 <code>require</code>,  <code>widget</code>,  <code>script</code> 标签用于处理静态资源和后端组件。</p>

<h3 id="基础结构">基础结构</h3>

<p>一个基础的 yog2 后端模板应该类似</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!doctype html&gt;
{% html framework=&quot;home:static/js/mod.js&quot; %}
    {% head %}
        &lt;title&gt;Hello World&lt;/title&gt;
    {% endhead %}
    {% body %}
    {% endbody %}
{% endhtml %}
</code></pre></div>
<p>可以将这种基础结构设置为母版页 <code>layout.tpl</code> 这样就不需要重复的编写 <code>html</code> <code>head</code> <code>body</code> 标签。</p>

<p>其中 <code>html</code> 标签的 <code>framework</code> 属性是一个特殊属性，用于指定模块化加载类库 <code>mod.js</code> 所在的路径。</p>

<h3 id="引用非模块化资源">引用非模块化资源</h3>

<p>如果希望引入非模块化资源，比如一些第三方库类似 <code>jquery</code> , <code>zepto</code> 等等，可以直接通过 <code>require</code> 标签进行引用，也可以直接编写 <code>&lt;script&gt;&lt;/script&gt;</code> HTML标签进行引用。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;!doctype html&gt;
{% html framework=&quot;home:static/js/mod.js&quot; %}
    {% head %}
        &lt;title&gt;Hello World&lt;/title&gt;
        {% require &quot;home:static/lib/jquery.js&quot; %}
        &lt;script src=&quot;/client/static/lib/zepto.js&quot; &gt;&lt;/script&gt;
    {% endhead %}
    {% body %}
    {% endbody %}
{% endhtml %}
</code></pre></div>
<p>两种引用方式都可以生效，但是更加推荐使用 <code>require</code> 标签，因此这种依赖声明模式是运行时声明的，你可以通过 {% if %} {% endif %}标签来实现后端动态化的资源加载。此外使用 <code>require</code> 加载的资源，可以被 fis 的静态资源管理层统一管理，而 <code>&lt;script&gt;</code> 标签加载的资源就类似传统的编写方式，fis 并不会在打包合并等操作时调整它。</p>

<h3 id="引用模块化资源">引用模块化资源</h3>

<p>模块化资源是指 <code>widget</code> 目录下的所有脚本资源，引用模块化资源分为同步引用和异步引用两种方式，但是两种方式都是按需加载，异步引用的区别是不会在页面加载的时候就将资源加载，而是会在执行到异步加载命令时进行资源加载。</p>

<p>同步引用模块化资源的方式符合 CommonJS 规范</p>

<p>在其他脚本中</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// 使用资源ID引用，资源ID为去掉 /client 目录层级的路径并添加当前项目的命名空间
var module = require(&#39;home:widget/search/search.js&#39;);

// 使用相对路径引用，相对路径需要按照源代码实际路径情况编写
module = require(&#39;./search.js&#39;);

// 使用绝对路径引用，需要以项目根目录计算路径

module = require(&#39;/client/widget/search/search.js&#39;);
</code></pre></div>
<p>异步引用模块化资源时，资源的引用规则还是保持一致，不同的是引用接口发生了变化</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// 使用资源ID引用，资源ID为去掉 /client 目录层级的路径并添加当前项目的命名空间
require.async([&#39;home:widget/search/search.js&#39;], function (module) {
});

// 使用相对路径引用，相对路径需要按照源代码实际路径情况编写
require.async([&#39;./search.js&#39;], function (module) {
});

// 使用绝对路径引用，需要以项目根目录计算路径

require.async([&#39;/client/widget/search/search.js&#39;], function (module) {
});
</code></pre></div>
<h3 id="内联脚本">内联脚本</h3>

<p>无论是页面中还是组件中，如果希望编写内联脚本，除非不希望被 fis 的静态资源管理层管理，否则需要使用 <code>script</code> 标签</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">{% script %}
console.log(&#39;inline script&#39;);
{% endscript %}
</code></pre></div>
<p>通过 <code>script</code> 标签包裹的内联脚本会在输出时，保证输出到静态资源加载之后，避免内联脚本在依赖的资源未加载时就提前执行了。</p>

<h3 id="编写后端组件">编写后端组件</h3>

<p>后端组件用于将一个复杂的站点按照功能区域划分为多个组件，来降低站点的复杂度。并且在 yog2 中，后端组件可以将 JavaScript脚本、CSS层叠样式、TPL 后端模板统一管理，这样在维护时可以轻松的根据功能点寻找到相应的代码，而无需分别在三类代码中去寻找相应的功能点。</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- /client/widget/search.tpl --&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&#39;{{ poiListID }}&#39;</span> <span class="na">class=</span><span class="s">&quot;poi-list&quot;</span><span class="nt">&gt;</span>
    {% for poi in pois %}
    <span class="nt">&lt;li</span> <span class="na">data-tel=</span><span class="s">&quot;{{ poi.telephone }}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span&gt;</span>{{ poi.name }}<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
    {% endfor %}
<span class="nt">&lt;/ul&gt;</span>
<span class="c">&lt;!-- 组件的脚本初始化入口 --&gt;</span>
{% script %}
<span class="c">&lt;!-- 获取search.js --&gt;</span>
require(&quot;./search.js&#39;).init(&#39;{{ poiListID }}&#39;);
{% endscript %}
<span class="c">&lt;!-- 声明加载search.less --&gt;</span>
{% require &quot;./search.less&quot; %}
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// /client/widget/search.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">target</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;tel: &#39;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-tel&#39;</span><span class="p">));</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div><div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/**</span>

<span class="c">/client/widget/search.less</span>

<span class="c">**/</span>
<span class="nc">.poi-list</span> <span class="p">{</span>
      <span class="k">list-style-type</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>

      <span class="o">&gt;</span> <span class="n">li</span> <span class="err">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="m">5px</span><span class="p">;</span>
      <span class="p">}</span>
<span class="err">}</span>
</code></pre></div>
<p>编写完成的后端组件一般就是一个独立的功能组件，我们可以直接在页面中引用而无需担心各种依赖问题。</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- /client/page/index.tpl --&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
{% html framework=&quot;home:static/js/mod.js&quot; %}
    {% head %}
        <span class="nt">&lt;title&gt;</span>Hello World<span class="nt">&lt;/title&gt;</span>
    {% endhead %}
    {% body %}
        {% widget &quot;home:widget/search/search.tpl&quot; %}
    {% endbody %}
{% endhtml %}
</code></pre></div>
      <blockquote>
        <p>文章有错误？直接提交修改 <a target="_blank" href="https://github.com/fex-team/yog2/edit/gh-pages/docs/fe/backend-template.md">docs/fe/backend-template.md</a></p>
      </blockquote>
      </article>
      <!-- footer -->
<section class="footer  flush--top">
    <div class="container">
        <div class="row">
            <ul class="list-unstyled  col-12  col-sm-3  col-lg-2">
                <li><a href="oak@baidu.com">Email</a></li>
                <li><a href="https://github.com/fex-team/yog2/issues" target="_blank">Github Issue</a></li>
            </ul>
            <ul class="list-unstyled  col-12  col-sm-2  col-lg-2">
                <li><a href="/yog2/">首页</a></li>
                <li><a href="/yog2/docs">文档</a></li>
                <li><a href="https://github.com/fex-team/yog2" target="_blank">Github</a></li>
                <li><a href="http://fis.baidu.com" target="_blank">FIS</a></li>
                <li><a href="http://fex.baidu.com" target="_blank">FEX</a></li>
            </ul>
            <div class="col-12  col-sm-7  col-lg-5  col-lg-offset-3  text-left  hard--left">
                <h3 class="footer--main-logo">加入我们</h3> FEX 是百度「Web 前端研发部」的内部名称
                <br/> 其中 FE 是 Front End 的缩写，X 代表我们不仅关注前端技术，还更重视全端及全栈的能力。
                <br/> 如果你对这个团队感兴趣，可以 <a class="underline" target="_blank" href="http://fex.baidu.com/we-need-you/">点击这里</a>。
            </div>
        </div>
    </div>
</section>
<!-- footer -->

    </div>
    </div>

    <!-- jQuery -->
    <script src="/yog2/js/jquery.js"></script>
    <script src="/yog2/js/scrollspy.js"></script>
    <script src="/yog2/js/toc.js"></script>
    <!-- Bootstrap js -->
    <script src="/yog2/js/bootstrap.min.js"></script>
    <!-- Optionally enable responsive features in IE8. Respond.js can be obtained from https://github.com/scottjehl/Respond -->
    <script src="/yog2/js/respond.min.js"></script>

  </body>

</html>
