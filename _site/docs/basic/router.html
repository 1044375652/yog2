<!DOCTYPE html>
<html>
    <!--head-->
    <head>
      <!-- page title goes here -->
<title>YOG2 - 工业级 Node.js UI 层解决方案</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<!-- add your name or URL here -->
<meta name="author" content="fex@baidu.com">
<!-- add a description of your site/company/product here -->
<meta name="description" content="YOG2 - 工业级 Node.js UI 层解决方案">
<!-- add the keywords here that represent your site, an example few have been added -->
<meta name="keywords" content="node, nodejs, fis, fex">
<!-- add your name or URL here -->
<meta name="publisher" content="fex">
<meta name="rating" content="General">
<!-- Bootstrap -->
<link href="/yog2/css/bootstrap.css" rel="stylesheet" media="screen">
<!-- Theme styles -->
<link href="/yog2/css/styles.css" rel="stylesheet" media="screen">
<link href="/yog2/css/animate.min.css" rel="stylesheet" media="screen">
<link href="/yog2/css/font-awesome.min.css" rel="stylesheet" media="screen">
<!-- media-queries -->
<link href="/yog2/css/media-queries.css" rel="stylesheet" media="screen">
<!-- modernizr -->
<script src="/yog2/js/modernizr.custom.js"></script>
<script src="/yog2/js/wow.min.js"></script>

      <link rel="stylesheet" href="/yog2/css/github.css">
    </head>
    <!--head-->
  <body>
    <nav class="navbar" role="navigation">
    <!-- container -->
<div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">YOG2</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse  navbar-collapse  navbar-ex1-collapse">
        <ul class="nav  navbar-nav">
            <li><a href="/yog2/">首页</a></li>
            <li><a href="/yog2/docs">文档</a></li>
            <li><a href="https://github.com/fex-team/yog2" target="_blank">Github</a></li>
            <li><a href="http://fis.baidu.com" target="_blank">FIS</a></li>
            <li><a href="http://fex.baidu.com" target="_blank">FEX</a></li>
        </ul>
    </div>
    <!-- /navbar-collapse -->
</div>
<!-- /container -->

    </nav>
    <div class="doc-wrap">
    <nav class="sidebar" data-spy="affix" data-offset-top="95">
    <ul>
        
        <li class="item-category">
            
            <a href="/yog2/docs/">
                快速入门
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                基础使用
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/cli.html#命令行">
                命令行
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/structure.html#目录结构">
                目录结构
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/router.html#路由">
                路由
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/basic/mvc.html#mvc">
                MVC
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                插件系统
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/plugin-system/#插件系统">
                内置插件
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/plugin-system/#用户插件">
                用户插件
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/plugin-system/#插件配置">
                插件配置
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                内置功能
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/features/middleware.html#中间件管理">
                中间件管理
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/features/log.html#日志管理">
                日志管理
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/features/service.html#服务管理">
                服务管理
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                前端工程化
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/engineering.html#前端工程化">
                目录规范
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/engineering.html#三种语言能力">
                三种语言能力
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/engineering.html#前端模块化">
                前端模块化
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/backend-template.html#后端模板">
                后端模板
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/fe/optimizer.html#性能优化">
                性能优化
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                进阶功能
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/advance/pagelet.html#BigPipe">
                BigPipe
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/advance/pagelet.html#Quickling">
                Quickling
            </a>
            
        </li>
        
        <li class="item-category">
            
            <span>
                其他
            </span>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/reference.html#参考资料">
                参考资料
            </a>
            
        </li>
        
        <li class="item-sub">
            
            <a href="/yog2/docs/FAQ.html#faq">
                FAQ
            </a>
            
        </li>
        
    </ul>
</nav>
<div class="bottom-shadow"></div>

    <div class="doc-container">
      <div class="toc" data-spy="affix" data-offset-top="95"></div>
      <article class="doc-content codehilite">
      <h2 id="路由">路由</h2>

<p>yog2 框架在 express 的路由基础上，提供了自动路由与多级路由系统。目的是让 UI 层开发更高效、更规范的同时又能够保证最大的灵活性。</p>

<p>yog2 的路由分为两类。一类是根路由，其角色与传统的 Express 路由非常类似，是所有请求的一致入口，因此我们在根路由拥有最大的自由度，可以做任何转发。另一类是 app 路由，它只能接收根路由分发到各个 app 的请求，请求在 app 中如何分发则可以完全由 app 路由控制。</p>

<h3 id="自动路由">自动路由</h3>

<p>基于 <code>约定优于配置</code> 的思想，我们提供了自动路由功能，目的是让开发者无需像 express 中一样手动注册路由，只需要在指定的目录按照指定的规则创建文件就可以创建一个 Web 服务。</p>

<h4 id="路由规则">路由规则</h4>

<p>自动路由用于管理url与action之间的映射关系，默认的路由规则为</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">http://www.example.com/home/index =&gt; app/home/action/index.js

http://www.example.com/home/doc/detail =&gt; app/home/action/doc/detail.js
</code></pre></div>
<p>如果上述规则没有匹配成功，会尝试匹配同名文件夹下的index.js，即</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">http://www.example.com/home/index =&gt; app/home/action/index/index.js

http://www.example.com/home/doc/detail =&gt; app/home/action/doc/detail/index.js
</code></pre></div>
<p>从上述规则我们可以看出，自动路由会将网站第一级目录识别为 app 的名称，会根据这个名称寻找同名的 app 进行转发。而在 app 路由的处理过程中，会根据 action 文件夹下的目录结构进行进一步的转发。</p>

<p>通过上述自动路由规则，我们可以不编写任何路由代码，就组织出一个拥有多级目录的站点。</p>

<h4 id="method-转发">method 转发</h4>

<p>同一个 <code>action</code> 文件一般只会对应一个 URL ，但是 yog2 提供了按照 <code>HTTP METHOD</code> 进行自动转发的能力，举例来说</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">//app/home/action/index.js

// GET /home/index
module.exports.get = function (req, res) {};

// POST /home/index
module.exports.post = function (req, res) {};

// PUT /home/index
module.exports.put = function (req, res) {};

// DELETE /home/index
module.exports.delete = function (req, res) {};
</code></pre></div>
<blockquote>
<p><code>METHOD</code> 名称均为小写</p>
</blockquote>

<p>通过 <code>METHOD</code> 转发功能，我们可以为同一个 URL ，分别定义在不同 <code>METHOD</code> 请求下的行为。</p>

<p>此外，如果同时存在 <code>module.exports</code> 函数与 <code>module.exports.$METHOD</code> 函数，如</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//app/home/action/index.js</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// GET /home/index</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{};</span>

<span class="c1">// POST /home/index</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">post</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{};</span>
</code></pre></div>
<p>此时无论是 <code>GET</code> 请求还是 <code>POST</code> 请求，都会先经过 <code>module.exports</code> 函数处理后再进入各自的 <code>METHOD</code> 函数，因此我们可以将 <code>module.exports</code> 函数视为 URL 级别的通用处理逻辑。</p>

<h3 id="路由扩展">路由扩展</h3>

<p>除了自动路由外，总会存在一些 URL 设计是自动路由无法满足的，因此 yog2 框架也提供了极为灵活的路由扩展能力，你甚至可以通过路由扩展能力完全的屏蔽自动路由的功能。</p>

<h4 id="root路由扩展">root路由扩展</h4>

<p>根路由 rootRouter 是用于管理 yog2 项目的根路由，通过扩展根路由，我们可以完全的控制请求入口。</p>

<blockquote>
<p>rootRouter可以在 project目录中的 <code>conf/plugins/dispatcher.js</code> 中修改</p>

<p>router更多的使用方法可以参考 <a href="http://expressjs.com/4x/api.html#router">Express文档</a></p>
</blockquote>

<p>可以为一个app设置一个别名</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/custom&#39;</span><span class="p">,</span> <span class="nx">yog</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">router</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">))</span>
<span class="c1">// http://www.example.com/custom =&gt; app/home/index/index.js</span>
</code></pre></div>
<p>可以直接建立一个特殊的URL</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/somespecial&#39;</span><span class="p">,</span> <span class="nx">yog</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;home/doc/detail&#39;</span><span class="p">))</span>
<span class="c1">// http://www.example.com/somespecial =&gt; app/home/doc/detail.js</span>
</code></pre></div>
<p>也可以在此处将router当成app使用，加载任意中间件</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="app路由扩展">app路由扩展</h4>

<p>appRouter 用于管理进入 app 后的请求分发，在这里你可以加载 app 级别的中间件或者通用逻辑，也可以用于实现自动路由无法满足的URL设计需求。</p>

<blockquote>
<p>appRouter可以在 app 目录中的 <code>server/router.js</code> 中修改。</p>

<p>router更多的使用方法可以参考 <a href="http://expressjs.com/4x/api.html#router">Express文档</a></p>
</blockquote>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">router</span><span class="p">){</span>
    <span class="c1">// you can add app common logic here</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span>
    <span class="p">});</span>

    <span class="c1">// also you can add custom action</span>
    <span class="c1">// request /spa/some/hefangshi</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/some/:user&#39;</span><span class="p">,</span> <span class="nx">router</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;api&#39;</span><span class="p">));</span>

    <span class="c1">// or write action directly</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/some/:user&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">req</span><span class="p">){});</span>

    <span class="c1">// a restful api example</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;/book&#39;</span><span class="p">)</span>
        <span class="c1">// PUT /cdcd/book/id</span>
        <span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">).</span><span class="nx">put</span><span class="p">)</span>
        <span class="c1">// GET /cdcd/book</span>
        <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">));</span>

    <span class="nx">router</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;/book/id/:id&#39;</span><span class="p">)</span>
        <span class="c1">// GET /cdcd/book/id</span>
        <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">)</span>
        <span class="c1">// DELETE /cdcd/book/id</span>
        <span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">).</span><span class="k">delete</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
      <blockquote>
        <p>文章有错误？直接提交修改 <a target="_blank" href="https://github.com/fex-team/yog2/edit/gh-pages/docs/basic/router.md">docs/basic/router.md</a></p>
      </blockquote>
      </article>
      <!-- footer -->
<section class="footer  flush--top">
    <div class="container">
        <div class="row">
            <ul class="list-unstyled  col-12  col-sm-3  col-lg-2">
                <li><a href="oak@baidu.com">Email</a></li>
                <li><a href="https://github.com/fex-team/yog2/issues" target="_blank">Github Issue</a></li>
            </ul>
            <ul class="list-unstyled  col-12  col-sm-2  col-lg-2">
                <li><a href="/yog2/">首页</a></li>
                <li><a href="/yog2/docs">文档</a></li>
                <li><a href="https://github.com/fex-team/yog2" target="_blank">Github</a></li>
                <li><a href="http://fis.baidu.com" target="_blank">FIS</a></li>
                <li><a href="http://fex.baidu.com" target="_blank">FEX</a></li>
            </ul>
            <div class="col-12  col-sm-7  col-lg-5  col-lg-offset-3  text-left  hard--left">
                <h3 class="footer--main-logo">加入我们</h3> FEX 是百度「Web 前端研发部」的内部名称
                <br/> 其中 FE 是 Front End 的缩写，X 代表我们不仅关注前端技术，还更重视全端及全栈的能力。
                <br/> 如果你对这个团队感兴趣，可以 <a class="underline" target="_blank" href="http://fex.baidu.com/we-need-you/">点击这里</a>。
            </div>
        </div>
    </div>
</section>
<!-- footer -->

    </div>
    </div>

    <!-- jQuery -->
    <script src="/yog2/js/jquery.js"></script>
    <script src="/yog2/js/scrollspy.js"></script>
    <script src="/yog2/js/toc.js"></script>
    <!-- Bootstrap js -->
    <script src="/yog2/js/bootstrap.min.js"></script>
    <!-- Optionally enable responsive features in IE8. Respond.js can be obtained from https://github.com/scottjehl/Respond -->
    <script src="/yog2/js/respond.min.js"></script>

  </body>

</html>
